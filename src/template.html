<!doctype html>
<html lang="en-us">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>Dolly and the Atom Smasher</title>
	</head>
<!-- 	<body style="margin: 0; padding: 8px;">
		<div id="log" style='font-family: "Courier New"; font-size: 14px;'></div>
		<canvas style="padding: none; border 0px none;" id="canvas" oncontextmenu="event.preventDefault()"></canvas> -->
	<body style="margin: 0; padding: 8px; background-color: #000000;">
		<div style='position: absolute; margin: auto; top: 50%; left: 50%; -moz-transform: translateX(-50%) translateY(-50%); -ms-transform: translateX(-50%) translateY(-50%); -webkit-transform: translateX(-50%) translateY(-50%); transform: translateX(-50%) translateY(-50%);'>
			<div id="log" style='font-family: "Courier New"; font-size: 14px; color: #FFFFFF;'></div>
			<canvas style="padding: none; border 0px none;" id="canvas" oncontextmenu="event.preventDefault()"></canvas>
		</div>

		<script type='text/javascript'>
			var log_elem = document.getElementById('log');

			var Module = {
				preRun: [ function() {
					try {
						Module.local_store_safe_to_read_write = false;

						FS.mkdir('/user_dat');
						FS.mount(IDBFS, {}, '/user_dat');
						FS.syncfs(true, function(err) {
							if(err) {
								console.error("ERROR: " + err + "\n");
							}
							else {
								Module.local_store_safe_to_read_write = true;
							}
						});
					}
					catch(e) {
						console.error("ERROR: " + e + "\n");
						Module.local_store_safe_to_read_write = false;
					}
				}],

				postRun: [ function() {
					log_elem.innerHTML = '';
				}],

				print: function(text) {
					if(arguments.length > 1) {
						text = Array.prototype.slice.call(arguments).join(' ');
					}

					console.log(text);
				},

				printErr: function(text) {
					if(arguments.length > 1) {
						text = Array.prototype.slice.call(arguments).join(' ');
					}

					console.error(text);
				},

				canvas: (function() {
					var canvas = document.getElementById('canvas');

					// As a default initial behavior, pop up an alert when webgl context is lost. To make your
					// application robust, you may want to override this behavior before shipping!
					// See http://www.khronos.org/registry/webgl/specs/latest/1.0/#5.15.2
					canvas.addEventListener("webglcontextlost", function(e) { alert('WebGL context lost. You will need to reload the page.'); e.preventDefault(); }, false);
					return canvas;
				})(),

				setStatus: function(text) {
					if(text !== '') {
						text = text.replace(/#/g, 'â–ˆ');
						console.log('STATUS: ' + text + '\n');
						log_elem.innerHTML = text;
					}
				},

				totalDependencies: 0,
				monitorRunDependencies: function(left) {
					this.totalDependencies = Math.max(this.totalDependencies, left);
					//TODO: Do we really need to see this??
					// Module.setStatus(left ? 'Preparing... (' + (this.totalDependencies - left) + '/' + this.totalDependencies + ')' : 'All downloads complete.');
				}
			};

			window.onerror = function(event) {
				Module.setStatus('EXCEPTION: ' + event + '\n');
			};
		</script>
		{{{ SCRIPT }}}
	</body>
</html>
